---
phase: 05-ui-infrastructure
plan: 04
type: execute
wave: 3
depends_on: [05-02, 05-03]
files_modified: [src/common/hooks/useDarkMode.ts, src/App.tsx, src/index.css]
autonomous: true
must_haves:
  truths:
    - "Dark mode is synchronized with Home Assistant hass.themes.darkMode state"
    - "document.documentElement correctly toggles the .dark class"
    - "Shadcn components respond correctly to the dark mode state"
  artifacts:
    - path: "src/common/hooks/useDarkMode.ts"
      provides: "Hook for HA dark mode synchronization"
---

<objective>
Synchronize the dashboard's dark mode with the Home Assistant theme state. This ensures a seamless visual experience when the user toggles dark mode in HA or when it follows system settings.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ui-infrastructure/05-CONTEXT.md
@.planning/phases/05-ui-infrastructure/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement useDarkMode Hook</name>
  <files>src/common/hooks/useDarkMode.ts</files>
  <action>
    1. Create `src/common/hooks/useDarkMode.ts`.
    2. Use `useHass` (or existing state management) to access `hass.themes.darkMode`.
    3. Implement an `useEffect` that adds/removes the `dark` class from `document.documentElement` based on the HA dark mode state.
  </action>
  <verify>
    - `useDarkMode.ts` correctly reacts to changes in HA state.
  </verify>
  <done>Dark mode synchronization hook is implemented.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate Hook into App Root</name>
  <files>src/App.tsx</files>
  <action>
    Call `useDarkMode()` in the `App` component to activate the synchronization logic.
  </action>
  <verify>
    - `App.tsx` invokes the hook.
  </verify>
  <done>Dark mode sync is integrated into the application.</done>
</task>

<task type="auto">
  <name>Task 3: Map Dark Mode to HA CSS Variables</name>
  <files>src/index.css</files>
  <action>
    Configure the `.dark` selector in `src/index.css` to map shadcn/tailwind theme variables to Home Assistant CSS variables.
    Example:
    ```css
    .dark {
      --background: var(--primary-background-color);
      --foreground: var(--primary-text-color);
      /* Add other relevant HA variable mappings */
    }
    ```
    Ensure this complies with requirement UI-08.
  </action>
  <verify>
    - `src/index.css` contains mappings to HA CSS variables within the `.dark` class.
  </verify>
  <done>Dark mode theme variables are mapped to Home Assistant CSS variables.</done>
</task>

</tasks>

<verification>
1. Simulate a change in `hass.themes.darkMode` (e.g., via browser console or React DevTools).
2. Verify that the `dark` class is toggled on the `<html>` element.
3. Verify that the application uses Home Assistant CSS variables for colors when in dark mode.
4. Verify that shadcn components (like a Button or Card) reflect these colors correctly.
</verification>

<success_criteria>

- Dashboard theme follows Home Assistant dark mode preference.
- Theme variables are mapped to Home Assistant's native CSS variables.
- All shadcn components are dark-mode aware and use HA colors.
  </success_criteria>

<output>
After completion, create `.planning/phases/05-ui-infrastructure/05-04-SUMMARY.md`
</output>
