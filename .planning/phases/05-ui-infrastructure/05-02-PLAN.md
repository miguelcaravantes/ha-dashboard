---
phase: 05-ui-infrastructure
plan: 02
type: execute
wave: 2
depends_on: [05-01]
files_modified: [src/common/MuiLayerProvider.tsx, src/App.tsx]
autonomous: true
must_haves:
  truths:
    - "MUI styles are wrapped in a low-priority CSS Cascade Layer (@layer mui)"
    - "Tailwind utilities have specificity precedence over MUI components"
  artifacts:
    - path: "src/common/MuiLayerProvider.tsx"
      provides: "Emotion CacheProvider with Stylis plugin for layering MUI"
---

<objective>
Implement a custom Emotion cache provider to wrap all MUI-generated styles into a CSS Cascade Layer. This ensures MUI components respect the layer priority established in the root CSS.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ui-infrastructure/05-CONTEXT.md
@.planning/phases/05-ui-infrastructure/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement MUI Layer Provider</name>
  <files>src/common/MuiLayerProvider.tsx</files>
  <action>
    1. Create `src/common/MuiLayerProvider.tsx`.
    2. Import `createCache` from `@emotion/cache` and `CacheProvider` from `@emotion/react`.
    3. Implement a Stylis plugin that wraps all rules in `@layer mui { ... }`.
    4. Export a `MuiLayerProvider` component that wraps its children in the custom cache.
  </action>
  <verify>
    - `MuiLayerProvider.tsx` correctly implements the Stylis plugin for layering.
  </verify>
  <done>MUI Layer Provider is implemented.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate UI Infrastructure</name>
  <files>src/App.tsx</files>
  <action>
    1. Import `src/index.css` in `src/App.tsx`.
    2. Import `MuiLayerProvider` and wrap the component tree (inside ThemeProvider but wrapping the main content).
  </action>
  <verify>
    - `App.tsx` imports the CSS and uses the layer provider.
    - Application still renders correctly.
  </verify>
  <done>UI Infrastructure is integrated into the application root.</done>
</task>

</tasks>

<verification>
1. Run `npm run dev` and check the browser.
2. Inspect a MUI element (e.g., a Button or Typography) in DevTools. Verify its styles are inside `@layer mui`.
3. Verify that adding a Tailwind utility like `!bg-red-500` (or just `bg-red-500` if the layer order works) to a MUI component overrides its internal styles.
</verification>

<success_criteria>

- MUI styles are successfully injected into the `@layer mui`.
- Tailwind utilities override MUI styles without requiring `!important` due to layer precedence.
  </success_criteria>

<output>
After completion, create `.planning/phases/05-ui-infrastructure/05-02-SUMMARY.md`
</output>
