---
phase: 01-infrastructure-foundation
plan: 02
type: execute
wave: 2
depends_on: ['01-01']
files_modified: ['package.json', 'vite.config.ts']
autonomous: true
must_haves:
  truths:
    - 'Vite is upgraded to version 7.x'
    - 'Development server starts successfully'
    - 'Production build completes without errors'
  artifacts:
    - path: 'vite.config.ts'
      provides: 'Modernized build configuration'
  key_links:
    - from: 'vite.config.ts'
      to: 'src/index.jsx'
      via: 'build.rollupOptions.input'
---

<objective>
Upgrade the build system to Vite 7 and modernize the configuration for Home Assistant compatibility.

Purpose: Leveraging Vite 7's performance and stability while ensuring the app still loads correctly in HA.
Output: Modernized Vite configuration and upgraded dependencies.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-infrastructure-foundation/01-01-SUMMARY.md
@.planning/phases/01-infrastructure-foundation/01-RESEARCH.md
@vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Upgrade Build Dependencies</name>
  <files>package.json</files>
  <action>Install latest versions of `vite` and `@vitejs/plugin-react` using `npm install -D vite@latest @vitejs/plugin-react@latest`.</action>
  <verify>npm list vite @vitejs/plugin-react</verify>
  <done>Vite is at version 7.x in package.json.</done>
</task>

<task type="auto">
  <name>Task 2: Modernize Vite Configuration</name>
  <files>vite.config.ts</files>
  <action>
    Update `vite.config.ts` with the following:
    - Set `base: './'` (Critical for HA).
    - Configure `build.target` to `esnext`.
    - Set `build.assetsDir` to `./`.
    - Ensure `rollupOptions.input` points to `src/index.jsx`.
    - Ensure `rollupOptions.output.entryFileNames` is set to `[name].js`.
    - Enable HMR in the server config (`server: { port: 8080, hmr: true }`).
  </action>
  <verify>cat vite.config.ts</verify>
  <done>vite.config.ts matches the recommended patterns in RESEARCH.md.</done>
</task>

<task type="auto">
  <name>Task 3: Verify Build Pipeline</name>
  <files>dist/</files>
  <action>Run `npm run build` and verify that the `dist` directory contains the expected assets and that the build completes successfully.</action>
  <verify>ls -R dist/</verify>
  <done>Build succeeds and produces output in dist/.</done>
</task>

</tasks>

<verification>
1. Check vite version in package.json.
2. Run `npm run build`.
3. Check dist/index.js exists.
</verification>

<success_criteria>
Build pipeline uses Vite 7 and produces HA-compatible artifacts.
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-foundation/01-02-SUMMARY.md`
</output>
