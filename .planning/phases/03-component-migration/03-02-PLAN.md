---
phase: 03-component-migration
plan: 02
type: execute
wave: 2
depends_on: ['03-01']
files_modified:
  [
    src/features/Panel.tsx,
    src/features/EntityPage.tsx,
    src/features/CardDashboard.tsx,
    src/common/composition.ts,
  ]
autonomous: true

must_haves:
  truths:
    - 'Dashboard layout uses MUI Grid v2 size prop'
    - 'Dashboard widgets respond to their container width via Container Queries'
    - 'Main navigational components are strictly typed'
  artifacts:
    - path: 'src/features/CardDashboard.tsx'
      provides: 'Responsive widget grid'
  key_links:
    - from: 'src/features/CardDashboard.tsx'
      to: '@mui/material/Grid'
      via: 'size prop'
---

<objective>
Migrate the main dashboard and panel components to TSX and adopt modern MUI v7 layout patterns.
This includes replacing legacy Grid props with the Grid v2 'size' API and implementing Container Queries for better responsiveness.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-component-migration/03-RESEARCH.md
@src/features/Panel.jsx
@src/features/EntityPage.jsx
@src/features/CardDashboard.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert Dashboard Components to TSX</name>
  <files>src/features/Panel.tsx, src/features/EntityPage.tsx, src/features/CardDashboard.tsx, src/common/composition.ts</files>
  <action>
    Rename Panel.jsx, EntityPage.jsx, CardDashboard.jsx to .tsx, and composition.js to .ts.
    Define Prop interfaces for these components.
    Resolve strict TS errors, particularly around Hass object usage and child components.
  </action>
  <verify>Run `npx tsc --noEmit` and ensure no errors in these files.</verify>
  <done>Core layout components are converted to strict TSX.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate to Grid v2</name>
  <files>src/features/EntityPage.tsx, src/features/CardDashboard.tsx</files>
  <action>
    Replace legacy Grid props (xs, sm, md, lg) with the 'size' prop (e.g., size={{ xs: 12, md: 6 }}).
    Ensure the Grid import is from @mui/material/Grid (which is v2 in MUI v7).
    Standardize spacing using the theme's spacing constants.
  </action>
  <verify>Visually verify that the dashboard layout remains correct and responsive.</verify>
  <done>Layouts use the modern Grid v2 API.</done>
</task>

<task type="auto">
  <name>Task 3: Implement Dashboard Container Queries</name>
  <files>src/features/CardDashboard.tsx</files>
  <action>
    Apply `containerType: 'inline-size'` to the dashboard container using the `sx` prop.
    Use MUI's container query shorthand (e.g., '@300': { ... }) to adjust grid item sizes or spacing based on the dashboard container's width.
  </action>
  <verify>Resize the dashboard container and observe layout changes at defined breakpoints.</verify>
  <done>Dashboard uses Container Queries for responsiveness.</done>
</task>

</tasks>

<verification>
Run `npx tsc --noEmit`.
Visually inspect the dashboard at different viewport and container sizes.
</verification>

<success_criteria>

- Dashboard compiles without type errors.
- Layout uses `size` prop instead of `xs/sm/md/lg`.
- Dashboard container has `container-type: inline-size`.
  </success_criteria>

<output>
After completion, create `.planning/phases/03-component-migration/03-02-SUMMARY.md`
</output>
