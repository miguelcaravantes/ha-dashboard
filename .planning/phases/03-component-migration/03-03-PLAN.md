---
phase: 03-component-migration
plan: 03
type: execute
wave: 2
depends_on: ['03-01']
files_modified:
  [
    src/features/EntityCard/EntityCard.tsx,
    src/features/EntityCard/PowerSwitch.tsx,
    src/features/EntityCard/SensorDisplay.tsx,
    src/features/EntityCard/ErrorBoundary.tsx,
    src/features/EntityIcon.tsx,
    src/features/Icon.tsx,
  ]
autonomous: true

must_haves:
  truths:
    - 'EntityCard internals adapt to card size via Container Queries'
    - 'EntityCard and variants are strictly typed with Prop interfaces'
    - 'Icon components handle missing or invalid icon strings gracefully'
  artifacts:
    - path: 'src/features/EntityCard/EntityCard.tsx'
      provides: 'Base entity card component'
  key_links:
    - from: 'src/features/EntityCard/EntityCard.tsx'
      to: 'src/common/hooks/useEntity.ts'
      via: 'hook call'
---

<objective>
Migrate the primary EntityCard component and its related sub-components to TSX.
Enhance EntityCard with Container Queries to ensure its internal elements (labels, icons, secondary info) look great regardless of whether the card is in a small or large grid slot.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-component-migration/03-RESEARCH.md
@src/features/EntityCard/EntityCard.jsx
@src/features/EntityCard/PowerSwitch.jsx
@src/features/EntityCard/SensorDisplay.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert EntityCard Suite to TSX</name>
  <files>src/features/EntityCard/EntityCard.tsx, src/features/EntityCard/PowerSwitch.tsx, src/features/EntityCard/SensorDisplay.tsx, src/features/EntityCard/ErrorBoundary.tsx</files>
  <action>
    Rename EntityCard.jsx, PowerSwitch.jsx, SensorDisplay.jsx, ErrorBoundary.jsx to .tsx.
    Define interfaces for Props.
    Resolve strict TS errors, ensuring stateObj and attributes are accessed safely.
    Fix any typing issues in the ErrorBoundary.
  </action>
  <verify>Run `npx tsc --noEmit` and ensure no errors in these files.</verify>
  <done>EntityCard components are strictly typed.</done>
</task>

<task type="auto">
  <name>Task 2: Convert Icon Components to TSX</name>
  <files>src/features/EntityIcon.tsx, src/features/Icon.tsx</files>
  <action>
    Rename EntityIcon.jsx and Icon.jsx to .tsx.
    Define Prop interfaces.
    Ensure Icon.tsx handles cases where the icon name might be undefined or in an unexpected format.
  </action>
  <verify>Run `npx tsc --noEmit` and ensure no errors.</verify>
  <done>Icon components are strictly typed.</done>
</task>

<task type="auto">
  <name>Task 3: Implement EntityCard Container Queries</name>
  <files>src/features/EntityCard/EntityCard.tsx</files>
  <action>
    Set `containerType: 'inline-size'` on the root Box of EntityCard.
    Use SX container queries to adjust typography size and padding when the card is narrow (e.g., < 150px) or wide (e.g., > 300px).
    Optionally hide secondary info if the card is too small.
  </action>
  <verify>Visually verify that card content scales and adjusts when the grid cell size changes.</verify>
  <done>EntityCard is responsive to its own container size.</done>
</task>

</tasks>

<verification>
Run `npx tsc --noEmit`.
Check EntityCard appearance in different grid sizes (e.g., size={3} vs size={6} vs size={12}).
</verification>

<success_criteria>

- EntityCard suite compiles successfully in strict mode.
- EntityCard uses Container Queries for internal responsiveness.
  </success_criteria>

<output>
After completion, create `.planning/phases/03-component-migration/03-03-SUMMARY.md`
</output>
