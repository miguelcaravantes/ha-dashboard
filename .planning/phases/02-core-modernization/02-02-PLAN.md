---
phase: 02-core-modernization
plan: 02
type: execute
wave: 2
depends_on: ['02-01']
files_modified:
  [
    package.json,
    tsconfig.json,
    src/index.tsx,
    src/common/HassProvider.tsx,
    src/common/hooks/useHass.ts,
    src/common/hooks/useEntity.ts,
  ]
must_haves:
  truths:
    - 'Developers access a strictly typed hass object'
    - 'React components are isolated from raw custom element events via useSyncExternalStore'
  artifacts:
    - path: 'tsconfig.json'
      provides: 'TypeScript configuration with allowJs'
    - path: 'src/common/HassProvider.tsx'
      provides: 'Typed context provider for Hass state'
    - path: 'src/common/hooks/useHass.ts'
      provides: 'Typed hook for Hass object'
  key_links:
    - from: 'src/index.tsx'
      to: 'src/common/HassProvider.tsx'
      via: 'Provider wrapper'
---

<objective>
Implement a type-safe data layer using Home Assistant types and isolate React from raw events.
Purpose: Provide a robust, developer-friendly way to interact with Home Assistant data with full IDE support and performance optimization via useSyncExternalStore.
Output: Typed HassProvider, converted hooks, and renamed index.tsx.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-core-modernization/02-01-SUMMARY.md
@tsconfig.json
@src/index.jsx
@src/common/hooks/useHass.js
@src/common/hooks/useEntity.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Environment Setup & HassProvider</name>
  <files>package.json, tsconfig.json, src/common/HassProvider.tsx</files>
  <action>
    Install `home-assistant-js-websocket` as a dependency.
    Enable `allowJs: true` in `tsconfig.json` to support mixed JS/TS codebase during migration.
    Create `src/common/HassProvider.tsx` using `HomeAssistant` type from `home-assistant-js-websocket`.
    Implement the store logic using `useSyncExternalStore` for optimized updates.
  </action>
  <verify>Check tsconfig.json for allowJs and HassProvider.tsx for types.</verify>
  <done>Environment is ready and HassProvider is implemented.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate Hooks to TypeScript</name>
  <files>src/common/hooks/useHass.ts, src/common/hooks/useEntity.ts</files>
  <action>
    Rename and update `src/common/hooks/useHass.js` and `src/common/hooks/useEntity.js` to `.ts`.
    Ensure `useHass` and `useEntity` return strictly typed objects.
    Refactor `useEntity` to use the typed `stateObj` from `HomeAssistant`.
  </action>
  <verify>tsc --noEmit</verify>
  <done>Hooks are converted to TypeScript and return typed data.</done>
</task>

<task type="auto">
  <name>Task 3: Migrate Entry Point & Provider Injection</name>
  <files>src/index.tsx</files>
  <action>
    Rename `src/index.jsx` to `src/index.tsx`.
    Inject `HassProvider` at the root in `src/index.tsx`.
    Fix any typing issues in the entry point.
  </action>
  <verify>npm run build</verify>
  <done>Entry point is migrated and HassProvider is active.</done>
</task>

</tasks>

<verification>
Run `npm run build` to ensure TypeScript compilation passes.
Verify that `useEntity` correctly extracts attributes from the typed `Hass` object.
</verification>

<success_criteria>

- `HomeAssistant` type is used throughout the data layer.
- Components using `useHass` or `useEntity` have full TypeScript autocompletion.
  </success_criteria>

<output>
After completion, create `.planning/phases/02-core-modernization/02-02-SUMMARY.md`
</output>
